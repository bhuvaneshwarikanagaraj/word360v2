<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vintage Straight Bag Zip Activity</title>

  <!-- LogRocket initialization -->
  <script src="https://cdn.lr-ingest.com/LogRocket.min.js"></script>
  <script>
      window.LogRocket && window.LogRocket.init('biy3cl/spelling');
      
      // Track zip activity page view
      LogRocket.track('Zip Activity Page View');
      
      // Identify user if needed
      LogRocket.identify('USER_ID', {
          name: 'Detective Ferret Player',
          gameProgress: 'episode2_zip'
      });
  </script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: fixed;
      background: #e8e0d8;
      font-family: 'Courier New', monospace;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='rgba(80,70,60,.05)' fill-rule='evenodd'/%3E%3C/svg%3E");
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    body {
      touch-action: none; /* Prevents all scrolling and zooming on touch devices */
    }

    .container {
      position: relative;
      width: min(300px, 90vw);
      height: min(400px, 70vh);
      perspective: 800px;
      margin: 20px auto;
    }
    .bag {
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #a08060, #94785c);
      border-radius: 20px;
      box-shadow: 
        inset 0 0 40px rgba(0,0,0,0.3),
        0 10px 20px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }
    .bag::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='rgba(0,0,0,.1)' fill-rule='evenodd'/%3E%3C/svg%3E");
      border-radius: 20px;
    }
    .bag-texture {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background-image: 
        repeating-linear-gradient(
          45deg, 
          transparent, 
          transparent 10px, 
          rgba(0,0,0,0.08) 10px, 
          rgba(0,0,0,0.08) 12px
        );
      opacity: 0.5;
    }
    .bag-wear {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background: 
        radial-gradient(circle at 30% 40%, rgba(0,0,0,0.2) 0%, transparent 20%),
        radial-gradient(circle at 70% 60%, rgba(0,0,0,0.15) 0%, transparent 25%);
    }
    .bag-patch {
      position: absolute;
      width: 50px;
      height: 30px;
      top: 65%;
      left: 20%;
      background: #866c50;
      border-radius: 8px;
      transform: rotate(15deg);
      box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
    }
    .bag-patch::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: 
        linear-gradient(45deg, transparent 65%, rgba(255,255,255,0.1) 65%, rgba(255,255,255,0.1) 70%, transparent 70%);
    }
    .bag-highlight {
      position: absolute;
      width: 80%;
      height: 50%;
      top: 10%;
      left: 10%;
      border-radius: 20px 20px 0 0;
      background: linear-gradient(180deg, 
        rgba(255,255,255,0.15) 0%, 
        rgba(255,255,255,0) 70%);
    }
    .zip-track {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 100%;
      background: #5c4d3e;
      z-index: 1;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.4);
    }
    .zip-teeth-container {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 100%;
      overflow: hidden;
      z-index: 2;
    }
    .teeth {
      position: absolute;
      width: 20px;
      height: 6px;
      background: #888;
      left: 0;
    }
    @keyframes zipperGlow {
      0%, 100% { filter: brightness(1); transform: scale(1); }
      50% { filter: brightness(1.3); transform: scale(1.1); }
    }
    .zipper {
      width: 30px;
      height: 26px;
      position: absolute;
      cursor: grab;
      z-index: 10;
      animation: zipperGlow 1.5s infinite;
    }
    .zipper-pull {
      width: 16px;
      height: 14px;
      border-radius: 2px;
      background: linear-gradient(135deg, #c0c0c0, #707070);
      position: absolute;
      top: 12px;
      left: 7px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.7);
    }
    .zipper-pull::after {
      content: '';
      position: absolute;
      width: 10px;
      height: 2px;
      background: #555;
      top: 6px;
      left: 3px;
    }
    .zipper-body {
      width: 10px;
      height: 18px;
      border-radius: 2px;
      background: linear-gradient(90deg, #b8b8b8, #888);
      position: absolute;
      top: 0;
      left: 10px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    .zipper-loop {
      width: 8px;
      height: 8px;
      border: 2px solid #707070;
      border-radius: 50%;
      position: absolute;
      top: 18px;
      left: 9px;
      box-shadow: 0 1px 1px rgba(0,0,0,0.4);
    }
    .bag-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #866c50, #7a6246);
      opacity: 0;
      transition: opacity 0.5s;
      z-index: 0;
      border-radius: 20px;
    }
    .bag-open {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #473a30;
      clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
      transition: clip-path 0.5s;
      z-index: 0;
      border-radius: 20px;
    }
    .instruction {
      margin-top: 15px;
      font-size: 18px;
      color: #4a3c2e;
      text-align: center;
      font-weight: bold;
      font-family: 'Courier New', monospace;
      letter-spacing: 1px;
      text-shadow: 1px 1px 0 rgba(255,255,255,0.3);
    }
    #nextBtn {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 16px;
      background: linear-gradient(to bottom, #6c584c, #503c2c);
      color: #eee;
      border: none;
      border-radius: 6px;
      cursor: not-allowed;
      opacity: 0.5;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: all 0.3s;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      letter-spacing: 1px;
    }
    #nextBtn.enabled {
      cursor: pointer;
      opacity: 1;
      background: linear-gradient(to bottom, #8b7d6b, #6c584c);
    }
    #nextBtn.enabled:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .progress-indicator {
      width: min(250px, 80vw);
      height: 8px;
      background: #d8cec2;
      border-radius: 4px;
      margin-top: 15px;
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, #866c50, #9e8570);
      transition: width 0.2s;
    }
    .indicator-arrow {
      position: absolute;
      width: 40px;
      height: 40px;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      animation: arrowMove 2s infinite;
      opacity: 0.9;
      pointer-events: none;
      z-index: 20;
    }
    .arrow-body {
      width: 25px;
      height: 25px;
      border-top: 6px solid #e63946;
      border-right: 6px solid #e63946;
      transform: rotate(-45deg);
      filter: drop-shadow(0px 0px 2px rgba(0,0,0,0.5));
    }
    @keyframes arrowMove {
      0% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-10px); }
      100% { transform: translateX(-50%) translateY(0); }
    }
    .vintage-label {
      position: absolute;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%) rotate(-10deg);
      font-family: 'Courier New', monospace;
      color: #4a3c2e;
      font-size: 12px;
      padding: 3px 8px;
      background: rgba(230, 220, 210, 0.5);
      border-radius: 3px;
      border: 1px solid #7a6246;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: bold;
      white-space: nowrap;
    }
    /* Add completion tag styles */
    .completion-tag {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(139, 69, 19, 0.9);
        color: #F5E6D3;
        padding: 5px 15px;
        border-radius: 15px;
        font-size: 12px;
        font-family: 'Courier New', monospace;
        z-index: 1000;
        display: none;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    /* Add completion message styles */
    .completion-message {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(139, 69, 19, 0.9);
        color: #F5E6D3;
        padding: 10px 20px;
        border-radius: 15px;
        font-family: 'Courier New', monospace;
        font-size: 16px;
        z-index: 1000;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        display: none;
    }
  </style>
</head>
<body>
  <div class="completion-tag" id="completionTag">COMPLETED</div>
  <div class="completion-message" id="completionMessage">Task Completed</div>
  <div class="container">
    <div class="bag">
      <div class="bag-texture"></div>
      <div class="bag-wear"></div>
      <div class="bag-patch"></div>
      <div class="bag-highlight"></div>
      <div class="bag-open" id="bagOpen"></div>
      <div class="bag-content" id="bagContent"></div>
      <div class="zip-track"></div>
      <div class="zip-teeth-container" id="zipTeeth"></div>
      <div class="vintage-label">Ticket to London</div>
      <div class="zipper" id="zipper">
        <div class="zipper-body"></div>
        <div class="zipper-pull"></div>
        <div class="zipper-loop"></div>
      </div>
      <div class="indicator-arrow" id="directionArrow">
        <div class="arrow-body"></div>
      </div>
    </div>
  </div>
  <div class="progress-indicator">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  <div class="instruction" id="instruction">Drag the zipper to close the bag</div>
  <button id="nextBtn">Next</button>
  
  <script>
    // Create the zipper teeth
    const zipTeeth = document.getElementById('zipTeeth');
    const teethCount = 30;
    const teethSpacing = 400 / teethCount;
    
    for (let i = 0; i < teethCount; i++) {
      const tooth = document.createElement('div');
      tooth.className = 'teeth';
      tooth.style.top = `${i * teethSpacing}px`;
      tooth.style.backgroundColor = i % 2 === 0 ? '#888' : '#666';
      zipTeeth.appendChild(tooth);
    }

    const zipper = document.getElementById('zipper');
    const container = document.querySelector('.container');
    const bagContent = document.getElementById('bagContent');
    const bagOpen = document.getElementById('bagOpen');
    const nextBtn = document.getElementById('nextBtn');
    const instruction = document.getElementById('instruction');
    const progressBar = document.getElementById('progressBar');
    const directionArrow = document.getElementById('directionArrow');
    
    let isDragging = false;
    let progress = 0;
    let isZipClosed = false; // Track if the zip is closed
    
    // Initialize position
    function initializePositioning() {
      // Position at the bottom of the bag
      zipper.style.left = '50%';
      zipper.style.transform = 'translateX(-50%)';
      zipper.style.top = '360px';
      
      // Check if activity was previously completed
      if (localStorage.getItem('ZIP_ACTIVITY_KEY') === 'true') {
        completeActivity();
      }
    }
    
    function completeActivity() {
      showCompletedState();
      
      // Try to notify parent window
      try {
        window.parent.postMessage('zip_success', '*');
      } catch (e) {
        console.error('Error posting message:', e);
      }
      
      // Set completion flag
      localStorage.setItem('ZIP_ACTIVITY_KEY', 'true');
    }
    
    // Drag functionality
    zipper.addEventListener('mousedown', startDragging);
    zipper.addEventListener('touchstart', startDragging);
    
    function startDragging(e) {
      // Prevent dragging if the zip is closed
      if (isZipClosed) {
        e.preventDefault();
        return;
      }
      isDragging = true;
      if (e.type === 'mousedown') {
        e.preventDefault(); // Prevent text selection
      }
      zipper.style.cursor = 'grabbing';
      
      // Stop the blinking animation
      zipper.style.animation = 'none';
      
      // Hide the direction arrow when user starts dragging
      directionArrow.style.display = 'none';
      
      // Track drag start with LogRocket
      LogRocket.track('Zip Drag Started');
    }
    
    document.addEventListener('mouseup', stopDragging);
    document.addEventListener('touchend', stopDragging);
    
    function stopDragging() {
      isDragging = false;
      zipper.style.cursor = isZipClosed ? 'default' : 'grab';
    }
    
    document.addEventListener('mousemove', handleDrag);
    document.addEventListener('touchmove', handleDrag, { passive: false });
    
    function handleDrag(e) {
      if (!isDragging || isZipClosed) return;
      
      let clientY;
      
      if (e.type === 'touchmove') {
        e.preventDefault();
        const touch = e.touches[0];
        clientY = touch.clientY;
      } else {
        clientY = e.clientY;
      }
      
      const rect = container.getBoundingClientRect();
      const containerTop = rect.top;
      const containerBottom = rect.bottom;
      
      // Calculate new position within boundaries
      let newTop = clientY - rect.top - zipper.offsetHeight / 2;
      newTop = Math.max(0, Math.min(newTop, rect.height - zipper.offsetHeight));
      
      // Only allow upward movement
      const currentTop = parseInt(zipper.style.top) || 360;
      if (newTop < currentTop) {
        zipper.style.top = `${newTop}px`;
        
        // Update progress (invert because we're going from bottom to top)
        progress = 100 - (newTop / (rect.height - zipper.offsetHeight) * 100);
        if (progress > 95) progress = 100;
        
        progressBar.style.width = `${progress}%`;
        bagContent.style.opacity = progress / 100;
        
        // Update the open part of the bag
        const openingHeight = 100 - progress;
        bagOpen.style.clipPath = `polygon(0 0, 100% 0, 100% ${openingHeight}%, 0 ${openingHeight}%)`;
        
        // Hide teeth that have been passed
        const teeth = document.querySelectorAll('.teeth');
        teeth.forEach((tooth, i) => {
          const toothTop = parseInt(tooth.style.top);
          if (toothTop < newTop) {
            tooth.style.display = 'block';
          } else {
            tooth.style.display = 'none';
          }
        });
        
        // Track progress milestones with LogRocket
        if (progress >= 25 && progress < 26) {
          LogRocket.track('Zip 25% Closed');
        } else if (progress >= 50 && progress < 51) {
          LogRocket.track('Zip 50% Closed');
        } else if (progress >= 75 && progress < 76) {
          LogRocket.track('Zip 75% Closed');
        }
        
        // Check if complete
        if (progress >= 100) {
          isZipClosed = true; // Mark the zip as closed
          zipper.style.top = '0px';
          zipper.style.cursor = 'default';
          zipper.style.animation = 'none';
          nextBtn.classList.add('enabled');
          nextBtn.disabled = false;
          instruction.innerText = "Bag closed! Click Next";
          localStorage.setItem('ZIP_ACTIVITY_KEY', 'true');
          document.getElementById('completionMessage').style.display = 'block';
          
          // Track completion with LogRocket
          LogRocket.track('Zip Activity Completed');
        }
      }
    }
    
    // Handle window resize
    window.addEventListener('resize', initializePositioning);
    
    // Initialize when page is loaded
    window.addEventListener('load', initializePositioning);
    
    nextBtn.addEventListener('click', () => {
      if (!nextBtn.classList.contains('enabled')) return;
      
      // Track button click with LogRocket
      LogRocket.track('Next Button Clicked');
      
      // Navigate back to index1.html with panel parameter set to 3
      window.location.href = './index1.html?panel=3';
    });

    // Check if activity was completed when page loads
    window.addEventListener('DOMContentLoaded', () => {
        // Check if activity was previously completed
        if (localStorage.getItem('ZIP_ACTIVITY_KEY') === 'true') {
            document.getElementById('completionMessage').style.display = 'block';
            showCompletedState();
        }
    });

    // New function to show completed state without navigation
    function showCompletedState() {
        isZipClosed = true;
        zipper.style.top = '0px';
        zipper.style.cursor = 'default';
        zipper.style.animation = 'none';
        nextBtn.classList.add('enabled');
        nextBtn.disabled = false;
        instruction.innerText = "Bag closed! Click Next";
        progressBar.style.width = '100%';
        bagContent.style.opacity = 1;
        bagOpen.style.clipPath = 'polygon(0 0, 100% 0, 100% 0, 0 0)';
        directionArrow.style.display = 'none';
        document.getElementById('completionMessage').style.display = 'block';
        
        // Hide zipper teeth
        const teeth = document.querySelectorAll('.teeth');
        teeth.forEach(tooth => {
            tooth.style.display = 'none';
        });
    }

    // Add close button handler
    document.querySelector('.close-button').addEventListener('click', () => {
        window.location.href = 'index1.html?panel=2';
    });
  </script>
  <script src="../disable-search.js"></script>
</body>
</html>